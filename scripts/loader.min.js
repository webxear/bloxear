function desanitizeAndInjectCSS(e,t){var e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&"),e=(new DOMParser).parseFromString(e,"text/html"),a=document.createElement("style");return a.textContent=t,e.head.appendChild(a),"<!DOCTYPE html>\n"+e.documentElement.outerHTML}let CACHE_CONFIG={duration:3e5,prefix:"gblocks_dynamic_",enabled:!0},CacheManager={get(e){if(!CACHE_CONFIG.enabled)return null;try{var t,a,r=CACHE_CONFIG.prefix+e,o=localStorage.getItem(r);return o?({data:t,timestamp:a}=JSON.parse(o),Date.now()-a>CACHE_CONFIG.duration?(localStorage.removeItem(r),null):(console.log("📦 Cache HIT for "+e),t)):null}catch(e){return console.warn("Cache get error:",e),null}},set(e,t){if(CACHE_CONFIG.enabled)try{var a=CACHE_CONFIG.prefix+e,r={data:t,timestamp:Date.now()};localStorage.setItem(a,JSON.stringify(r)),console.log("💾 Cache SET for "+e)}catch(e){console.warn("Cache set error:",e),"QuotaExceededError"===e.name&&this.clearExpired()}},clearExpired(){var t=Date.now(),a=[];for(let e=0;e<localStorage.length;e++){var r=localStorage.key(e);if(r&&r.startsWith(CACHE_CONFIG.prefix))try{t-JSON.parse(localStorage.getItem(r)).timestamp>CACHE_CONFIG.duration&&a.push(r)}catch(e){a.push(r)}}a.forEach(e=>localStorage.removeItem(e)),console.log(`🧹 Cleared ${a.length} expired cache entries`)},clearAll(){var t=[];for(let e=0;e<localStorage.length;e++){var a=localStorage.key(e);a&&a.startsWith(CACHE_CONFIG.prefix)&&t.push(a)}t.forEach(e=>localStorage.removeItem(e)),console.log(`🗑️ Cleared all ${t.length} cache entries`)}};async function fetchDynamicData(t){var e={posts:"/api/v1/design/dynamic/posts",authors:"/api/v1/design/dynamic/authors",tags:"/api/v1/design/dynamic/tags",pages:"/api/v1/design/dynamic/pages"}[t];if(!e)return console.warn("Unknown data type: "+t),[];var a=CacheManager.get(t);if(a)return a;try{console.log(`🌐 Fetching fresh ${t} data from API...`);var r=await(await fetch("https://api.bloxear.com"+e)).json();return 200===r.statusCode&&r.data?(CacheManager.set(t,r.data),r.data):(console.warn(`No data found for ${t}:`,r),[])}catch(e){return console.error(`Error fetching ${t} data:`,e),[]}}function getNestedPropertyValue(e,t){return e&&t?t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:"",e):""}function sortData(e,o,n){return e&&Array.isArray(e)&&o?[...e].sort((e,t)=>{var a,r,e=getNestedPropertyValue(e,o),t=getNestedPropertyValue(t,o);return"string"==typeof e&&"string"==typeof t?"desc"===n?t.localeCompare(e):e.localeCompare(t):e instanceof Date&&t instanceof Date?"desc"===n?t-e:e-t:(a=new Date(e),r=new Date(t),isNaN(a)||isNaN(r)?"desc"===n?String(t).localeCompare(String(e)):String(e).localeCompare(String(t)):"desc"===n?r-a:a-r)}):e}function populateTemplate(e,r){e=e.cloneNode(!0);return e.removeAttribute("data-item-template"),e.style.display="",e.classList.remove("dynamic-item-template"),e.querySelectorAll("[data-bind-field]").forEach(e=>{var t=e.getAttribute("data-bind-field"),a=getNestedPropertyValue(r,t);if(a)switch(e.tagName.toLowerCase()){case"img":e.src=a,e.alt=e.alt||getNestedPropertyValue(r,"title")||"Image";break;case"a":t.includes("url")||t.includes("link")||t.includes("href")?e.href=a:e.textContent=a;break;case"input":e.value=a;break;default:e.textContent=a}}),e}async function processDynamicContainers(e){var t,a=document.querySelectorAll("[data-dynamic-type]");console.log(`🔗 Found ${a.length} dynamic containers`),e&&e.dynamicBindings&&e.dynamicBindings.containers&&0<e.dynamicBindings.containers.length&&console.log("📊 Dynamic bindings found:",e.dynamicBindings);for(t of a){var o=t.getAttribute("data-dynamic-type"),n=parseInt(t.getAttribute("data-item-count"))||6,l=t.getAttribute("data-sort-by")||"published_at",c=t.getAttribute("data-sort-order")||"desc";console.log(`📊 Processing ${o} container:`,{itemCount:n,sortBy:l,sortOrder:c,containerId:t.id});let r=t.querySelector('[data-item-template="true"]');if(r)try{var i=await fetchDynamicData(o);if(console.log(i),i&&0!==i.length){var s=sortData(i,l,c).slice(0,n);console.log(`✅ Processing ${s.length} ${o} items`);let a=document.createDocumentFragment();s.forEach((e,t)=>{e=populateTemplate(r,e);e.setAttribute("data-item-index",t.toString()),a.appendChild(e)}),t.appendChild(a),console.log(`🎉 Successfully populated ${o} container with ${s.length} items`)}else console.warn("📭 No data found for "+o),t.style.display="none"}catch(e){console.error(`❌ Error processing ${o} container:`,e),t.style.display="none"}else console.warn(`❌ No template found in ${o} container`)}}async function loader(){CacheManager.clearExpired();let e=window.location.pathname.replace(/^\/+|\/+$/g,"");e=e||"home";try{var t=await(await fetch("https://api.bloxear.com/api/v1/design/data",{headers:{slug:e}})).json(),a=(console.log("designData",t),JSON.parse(t.data)),r=desanitizeAndInjectCSS(a.html,a.css);document.write(r),console.log("🔄 Processing dynamic containers..."),await processDynamicContainers(a),console.log("✅ Dynamic container processing complete"),document.getElementById("page-preloader")?.remove(),document.body.style.display="block"}catch(e){console.error("❌ Loader error:",e),document.body.style.display="block"}}window.GBlocksCache={clear:()=>CacheManager.clearAll(),clearExpired:()=>CacheManager.clearExpired(),config:CACHE_CONFIG,setDuration:e=>{CACHE_CONFIG.duration=60*e*1e3,console.log(`Cache duration set to ${e} minutes`)},enable:()=>{CACHE_CONFIG.enabled=!0,console.log("Cache enabled")},disable:()=>{CACHE_CONFIG.enabled=!1,console.log("Cache disabled")}},loader();